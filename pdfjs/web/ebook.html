<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Leitor do e-book</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  background:#111;
  overflow-x:hidden;
  user-select:none;
  color:white;
  font-family:Arial, Helvetica, sans-serif;
}

#status{
  position:fixed;
  top:10px;
  left:10px;
  z-index:9999;
  background:rgba(0,0,0,.7);
  padding:10px 14px;
  border-radius:8px;
  font-size:13px;
}

#pages{
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
  padding:60px 0 20px;
}

canvas{
  max-width:95%;
  box-shadow:0 0 20px rgba(0,0,0,.6);
  background:white;
}

/* Marca d’água */
#watermark{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:5vw;
  font-weight:700;
  color:rgba(255,255,255,.07);
  transform:rotate(-30deg);
  pointer-events:none;
  z-index:999;
  text-align:center;
}
</style>
</head>

<body>

<div id="status">Carregando PDF...</div>
<div id="pages"></div>

<div id="watermark">
  USO PESSOAL • PROIBIDO DOWNLOAD<br>
  IMPRESSÃO OU COMPARTILHAMENTO
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

<script>
const statusBox = document.getElementById("status");

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";

const url = "../../ebook.pdf";
statusBox.innerText = "Buscando: " + url;

pdfjsLib.getDocument(url).promise.then(async pdf => {

  statusBox.innerText = "PDF carregado. Páginas: " + pdf.numPages;

  for(let i=1;i<=pdf.numPages;i++){
    statusBox.innerText = "Renderizando página " + i + " de " + pdf.numPages;

    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 1.3 });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    document.getElementById("pages").appendChild(canvas);

    await page.render({canvasContext:ctx, viewport}).promise;
  }

  statusBox.innerText = "Pronto.";

}).catch(err=>{
  console.error(err);
  statusBox.innerText = "❌ ERRO: " + err.message;
  alert("Erro ao carregar o ebook. Veja a caixa no canto.");
});

// Bloqueios básicos
document.addEventListener("contextmenu", e=>e.preventDefault());
document.addEventListener("keydown", e=>{
  if(
    (e.ctrlKey && ["s","p","u"].includes(e.key.toLowerCase())) ||
    e.key === "PrintScreen"
  ){
    e.preventDefault();
    alert("Download, impressão e captura estão desativados.");
  }
});
document.addEventListener("dragstart", e=>e.preventDefault());
</script>

</body>
</html>
